let itemInfo=null,bossInfo=null,dungeonInfo=null,minibossInfo=null,siegeInfo=null,pointOfInterestInfo=null;class ConnectionError extends Error{constructor(e){super(e),this.name="ConnectionError"}}async function initItemInfo(){if(null===itemInfo){const e=await fetch("https://eclipseblade.github.io/Remnant-World-Analyzer/data/items.json");if(!e.ok)throw new ConnectionError("Could Not Read Items");itemInfo=await e.json()}return itemInfo}async function initBossInfo(){if(null===bossInfo){const e=await fetch("https://eclipseblade.github.io/Remnant-World-Analyzer/data/bosses.json");if(!e.ok)throw new ConnectionError("Could Not Read Bosses");bossInfo=await e.json()}}async function initDungeonInfo(){if(null===dungeonInfo){const e=await fetch("https://eclipseblade.github.io/Remnant-World-Analyzer/data/dungeons.json");if(!e.ok)throw new ConnectionError("Could Not Read Dungeons");dungeonInfo=await e.json()}}async function initMinibossInfo(){if(null===minibossInfo){const e=await fetch("https://eclipseblade.github.io/Remnant-World-Analyzer/data/minibosses.json");if(!e.ok)throw new ConnectionError("Could Not Read Minibosses");minibossInfo=await e.json()}}async function initSiegeInfo(){if(null===siegeInfo){const e=await fetch("https://eclipseblade.github.io/Remnant-World-Analyzer/data/sieges.json");if(!e.ok)throw new ConnectionError("Could Not Read Sieges");siegeInfo=await e.json()}}async function initPointOfInterestInfo(){if(null===pointOfInterestInfo){const e=await fetch("https://eclipseblade.github.io/Remnant-World-Analyzer/data/pointOfInterests.json");if(!e.ok)throw new ConnectionError("Could Not Read Point of Interests");pointOfInterestInfo=await e.json()}}function deepCloneEvent({zone:e,eventDetails:n}){return{zone:e,eventDetails:n.map(({eventType:e,eventName:n,eventLink:t})=>({eventType:e,eventName:[...n],eventLink:[...t]}))}}function deepCloneSubEvent({eventType:e,eventName:n,eventLink:t}){return{eventType:e,eventName:[...n],eventLink:[...t]}}function getWorld(e){switch(e.toLowerCase()){case"city":return"Earth";case"wasteland":return"Rhom";case"swamp":return"Corsus";case"jungle":return"Yaesha";case"snow":return"Reisum";default:throw new Error("Invalid Location: "+e)}}function analyzeCampaign(e){}async function analyzeAdventure(e){const n=e.indexOf("_C",e.lastIndexOf("/Quests/Quest_"));if(-1===n)throw new Error("Invalid File Input");const t=e.lastIndexOf("Adventure",n);if(-1===t)throw new Error("Invalid File Input");const o=e.substring(t,n).split(/Game/g),i=getWorld(o[0].split(/_/)[1]);o.splice(0,1),await initItemInfo(),await initBossInfo(),await initDungeonInfo(),await initMinibossInfo(),await initSiegeInfo(),await initPointOfInterestInfo();const s={order:5,zone:["Overworld"],eventDetails:[]},r=(e,n)=>"Item Drop"===e.eventType?"Item Drop"===n.eventType?e.eventName[0]>n.eventName[0]?1:e.eventName[0]<n.eventName[0]?-1:0:1:"Item Drop"===n.eventType?-1:0,a=o.reduce((n,t)=>{const o=t.split(/\/Quest_/)[1].split(/_/);switch(o[0].toLowerCase()){case"event":if(!(o[1]in itemInfo))throw new Error("Invalid Item: "+o[1]);const t=deepCloneSubEvent(itemInfo[o[1]]);if(t){if("Sketterling"===o[1]){let n=-1;if(-1===(n="Mines"===o[2]?e.lastIndexOf("Sketterling_Bugs",e.indexOf("Sketterling_Mines")):e.lastIndexOf("Sketterling_Bugs")))throw new Error("Could Not Read Color of Sketterling");t.eventName[0]=("_"===e.charAt(n+48)?"Black":"Red")+t.eventName[0]}"CreepersPeepers"===o[1]||"Packmaster"===o[1]?s.eventDetails.push(t):n[n.length-1].eventDetails.push(t)}break;case"boss":if(!(o[1]in bossInfo))throw new Error("Invalid Boss: "+o[1]);const r={order:0,...deepCloneEvent(bossInfo[o[1]])};n.push(r);break;case"miniboss":if(!(o[1]in minibossInfo))throw new Error("Invalid Miniboss: "+o[1]);const a={order:1,...deepCloneEvent(minibossInfo[o[1]])};n.push(a);break;case"smalld":if(!(o[1]in dungeonInfo))throw new Error("Invalid Dungeon: "+o[1]);const l={order:2,...deepCloneEvent(dungeonInfo[o[1]])};n.push(l);break;case"siege":if(!(o[1]in siegeInfo))throw new Error("Invalid Siege: "+o[1]);const d={order:3,...deepCloneEvent(siegeInfo[o[1]])};n.push(d);break;case"overworldpoi":if(!(o[1]in pointOfInterestInfo))throw new Error("Invalid Point of Interest: "+o[1]);"Stuck Merchant"===o[1]&&n.push({order:4,...deepCloneEvent(dungeonInfo.GuardianShrine)}),s.eventDetails=pointOfInterestInfo[o[1]].map(e=>deepCloneSubEvent(e)).concat(s.eventDetails),n.push(s);break;case"cryptolith":"Rhom"===i&&n[n.length-1].eventDetails.push({eventType:"Item Drop: Ring",eventName:["Soul Link"],eventLink:["https://remnantfromtheashes.wiki.fextralife.com/Soul+Link"]});break;default:throw new Error("Invalid Event: "+o[0])}return n},[]).sort((e,n)=>e.order-n.order).map(({zone:e,eventDetails:n})=>({zone:e,eventDetails:n.sort(r)}));return{world:i,worldEvents:a}}function renderTable({world:e,worldEvents:n}){$("#world-info").empty();for(const{zone:t,eventDetails:o}of n){let n=0;2==t.length&&("Strange Pass"===t[0]&&n++,n++);for(let i=0;i<o.length;i++){const{eventType:s,eventName:r,eventLink:a}=o[i];let l=`<tr><td>${e}</td><td>${t[0]}`;i<n&&(l+=` (${t[1]})`),l+=`</td><td>${s}</td><td class="hyperlink">`;for(let e=0;e<a.length;e++)l+=`<a href="${a[e]}"  target="_blank">${r[e]}</a>`,e!==a.length-1&&(3===a.length?l+=" or ":"Houndmaster"===r[0]||"Wud"===r[0]?l+=" and ":l+=": ");l+="</td></tr>",$("#world-info").append(l)}}$("#connection-error").hide(),$("#form-file").removeClass("is-invalid"),$("#world-descriptor").show()}$("#world-input").submit(async e=>{e.preventDefault(),$("#loading").show();const n=$("#form-file")[0].files[0],t=new FileReader;t.readAsText(n),t.onload=(async()=>{try{let e=null;"Campaign"===$("#mode-select").val()?$("#mode-select").addClass("is-invalid"):($("#mode-select").removeClass("is-invalid"),e=await analyzeAdventure(t.result)),e&&renderTable(e)}catch(e){e instanceof ConnectionError?$("#connection-error").show():$("#form-file").addClass("is-invalid"),console.log(e)}$("#loading").hide()}),t.onerror=(()=>{$("#form-file").addClass("is-invalid"),console.log(t.error),$("#loading").hide()})});